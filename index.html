<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apex TV – APEX Live Games</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Discord Button -->
  <a href="https://discord.gg/5a9pxtmVCC" target="_blank" id="discord-btn">
    <img src="https://raw.githubusercontent.com/JacobPFC/ApexTV/e7d7c55a99633e65c1d80498d3423baac23b9838/images/discord-white-icon.webp" alt="Discord" />
  </a>

  <!-- Video Background -->
  <video autoplay muted loop id="bg-video">
    <source src="https://i.imgur.com/4uDFOaf.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <header>Apex TV – APEX Live Games</header>

  <!-- Announcements Section -->
  <div id="announcements"></div>

  <!-- Game Cards -->
  <div class="grid" id="gameGrid"></div>

  <script>
    const gameSheetURL = "https://api.sheetbest.com/sheets/77db05aa-9464-4a83-8276-cc9a1c7933f2";
    const announcementSheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTVEKnXC_xcQSK3-w-1khtOJQ4j0rbEsjdKtbqdjcJA5bs5_WTjTSTpQxkiCVg06a-c-1E0oTduvb16/pubhtml";

    // --- Announcements ---
    fetch(announcementSheetURL)
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        const rows = doc.querySelectorAll("table tbody tr");
        const container = document.getElementById('announcements');
        const today = new Date();

        rows.forEach(row => {
          const cells = row.querySelectorAll("td");
          if(cells.length >= 2) {
            const message = cells[0].textContent.trim();
            const dateStr = cells[1].textContent.trim();
            const msgDate = new Date(dateStr);
            msgDate.setDate(msgDate.getDate() + 1); // hide 1 day after
            if(msgDate < today) return;

            const div = document.createElement('div');
            div.className = 'announcement';
            div.textContent = message;
            container.appendChild(div);
          }
        });
      })
      .catch(err => console.error("Error loading announcements:", err));

    // --- Game Cards ---
    fetch(gameSheetURL)
      .then(res => res.json())
      .then(games => {
        const grid = document.getElementById('gameGrid');
        const today = new Date();
        grid.innerHTML = '';

        games.forEach(game => {
          if(game.Title && game.Thumbnail && game.Link) {
            if(game.Date) {
              const gameDate = new Date(game.Date);
              gameDate.setDate(gameDate.getDate() + 1); // hide 1 day after
              if(gameDate < today) return;
            }

            const card = document.createElement('div');
            card.className = 'game-card';
            card.onclick = () => window.open(game.Link, '_blank');

            card.innerHTML = `
              <img src="${game.Thumbnail}" class="thumb" />
              <div class="info">
                <div class="game-title">${game.Title}</div>
                <div class="game-time">${game.Time || ''}</div>
                <div class="game-date">${game.Date || ''}</div>
                ${game.Live === 'true' ? '<div class="live-tag">LIVE</div>' : ''}
              </div>
            `;

            grid.appendChild(card);
          }
        });
      })
      .catch(err => console.error('Error loading games:', err));
  </script>

</body>
</html>


